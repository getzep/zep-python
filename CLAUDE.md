# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Common Commands

### Development Commands
- `make format` - Format code using ruff
- `make lint` - Run type checking with mypy and linting with ruff
- `make test` - Run tests with pytest
- `make coverage` - Run tests with coverage reporting

### Package Management
- `poetry install` - Install dependencies
- `poetry add <package>` - Add new dependency
- `poetry run <command>` - Run command in virtual environment

### Testing
- `poetry run pytest tests` - Run all tests
- `poetry run pytest tests/path/to/test.py` - Run specific test file
- `poetry run pytest -k "test_name"` - Run tests matching pattern

## Code Architecture

### Core Structure
This is the **Zep Cloud Python SDK**, generated by Fern from API definitions. The codebase follows a client-server architecture pattern:

- **Main Client Classes**: `Zep` (sync) and `AsyncZep` (async) in `client.py`
- **Base Client**: `BaseClient` and `AsyncBaseClient` in `base_client.py` provide common functionality
- **Service Clients**: Organized by domain (memory, document, user, graph, group) in separate modules
- **External Clients**: Wrapper clients in `external_clients/` for simplified API usage
- **Type Definitions**: Comprehensive type models in `types/` directory

### Key Components
- **Memory Service**: Chat history management, search, and retrieval
- **Document Service**: Document collections and vector search
- **User Service**: User management and sessions
- **Graph Service**: Knowledge graph operations with nodes and edges
- **Group Service**: Group management functionality

### Client Architecture
- **Dual Interface**: Both sync and async clients for all operations
- **HTTP Client**: Built on httpx with configurable timeouts and redirects
- **Error Handling**: Structured error types (BadRequestError, NotFoundError, etc.)
- **Authentication**: API key-based authentication via `ZEP_API_KEY` environment variable

### Special Features
- **Autogen Adapter**: Memory adapter for Microsoft Autogen framework in `adapters/autogen.py`
- **LangChain Integration**: Compatible with LangChain's expression language
- **Environment Configuration**: Supports multiple deployment environments

### Generated Code
Most code is auto-generated by Fern from OpenAPI specifications. Manual changes should be minimal and focused on:
- Custom adapters and integrations
- Examples and documentation
- Test customizations

## ZepOpenAI Wrapper

The SDK includes a comprehensive OpenAI wrapper that provides drop-in replacement for the OpenAI client with automatic Zep memory integration:

### Key Features
- **Drop-in replacement**: Works exactly like OpenAI client when no session_id provided
- **Automatic memory integration**: Context injection and conversation storage when session_id provided
- **Full API support**: Both Chat Completions and Responses APIs
- **Streaming support**: Complete streaming support with memory collection
- **Async support**: Full async/await support for all operations
- **Error resilience**: Configurable error handling with skip_zep_on_error

### Usage
```python
from zep_cloud.client import Zep
from zep_cloud.external_clients import ZepOpenAI, AsyncZepOpenAI

# Sync client
zep_client = Zep(api_key="your-zep-key")
client = ZepOpenAI(zep_client=zep_client)

# Works like normal OpenAI client
response = client.chat.completions.create(
    model="gpt-4.1",
    messages=[{"role": "user", "content": "Hello"}]
)

# Enables Zep integration when session_id provided
response = client.chat.completions.create(
    model="gpt-4.1",
    messages=[
        {"role": "system", "content": "You are helpful. Context: {context}"},
        {"role": "user", "content": "My name is Alice"}
    ],
    session_id="user_123"  # Enables Zep memory integration
)
```

### Import Notes
Since the main `__init__.py` is auto-generated, import ZepOpenAI classes from:
```python
from zep_cloud.external_clients import ZepOpenAI, AsyncZepOpenAI
```

## Environment Variables
- `ZEP_API_KEY` - Required for authentication
- `ZEP_API_URL` - Optional custom API endpoint
- `OPENAI_API_KEY` - Required for ZepOpenAI wrapper and examples
- `ZEP_COLLECTION` - Used in examples and vector store demos